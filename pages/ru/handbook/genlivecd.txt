=====Создание Live CD=====

С помощью приложения Tazlito вы можете создавать свои Live CD SliTaz за очень короткое время. Вы можете выбрать именно те пакеты, которые нужны вам, и создать свой вариант Live CD, улучшенный за счет пакетов или других Live CD, созданных сообществом SliTaz. Tazlito является утилитой командной строки, при этом вовсе не сложной: создать ISO-образ системы вы можете всего двумя командами, а записать его на диск — одной.


===Обзор===

Tazlito автоматизирует процесс создания Live CD, сам же алгоритм выглядит так:

  - Скачать вариант дистрибутива, который будет подвергнут изменениям.
  - Изменить состав его пакетов (после этого можно также включить некоторые дополнительные файлы).
  - Сжать образ получившейся псевдо-файловой системы.
  - Записать ISO-образ на диск.


===Примечания===

  * Процесс создания Live CD требует минимум 256 Мб RAM.
  * Сжатие файловой системы при помощи алгоритма LZMA потребует значительно больше времени. Можно использовать также формат GZip — хотя он сжимает не так хорошо, зато быстро.
  * Создавать свой вариант дистрибутива можно как в Live CD, так и в установленной системе. При работе в Live CD рекомендуется использовать жесткий диск или флешку для хранения файлов и освобождения места в RAM.
  * Tazlito используется разработчиками SliTaz для создания официального Live CD. Единственное условие для работы по нашим инструкциям — это наличие Tazlito. Он установлен в Slitaz по умолчанию, но вы также можете создавать Live CD и из другого LiveCD-дистрибутива Linux при условии, что в нём присутствуют необходимые пакеты (если нет, их всегда можно скачать). Подробности см. в конце статьи.


=====Создание Live CD двумя командами=====

Знакомство с Tazlito неплохо начать с преобразования Live CD. Для этого скачайте базовый вариант системы (//core flavor//) — это файл с расширением //.flavor//, который содержит всю информацию, необходимую для создания Live CD — и создайте образ, используя настройки по умолчанию. Для этого потребуются всего две команды:

<code># tazlito get-flavor core</code>

(здесь также можно изменить состав дистрибутива, если это необходимо)

<code># tazlito gen-distro</code>

Вот и всё! Полученный образ будет находиться в папке ///home/slitaz/distro//.


=====Часть I. Скачивание одного из вариантов системы=====

Варианты конфигурации SliTaz (они называются flavors) могут использоваться для создания разнообразных Live CD, посколку в них содержится список пакетов (файл //distro-packages.list//) и (иногда) дополнительные файлы. Этот способ экономит силы при создании различных файлов конфигурации и дает возможность быстро переключаться между ними. Список таких вариантов доступен на серверах SliTaz, а скачать или обновить его можно с помощью все того же Tazlito:

<code># tazlito list-flavors</code>

или

<code># tazlito list-flavors --recharge</code>

При выполнении одной из этих команд будет автоматически выведен список доступных вариантов, показывающих размер Live CD и его краткое описание. Чтобы использовать тот или иной вариант, используйте команду 

<code># tazlito get-flavor имя_файла</code>

Эта команда автоматически скачает указанный вариант, распакует список пакетов и описание в текущую папку и добавит нужные файлы в папку ///home/slitaz/distro/addfiles//.

Описание варианта можно отобразить командой //show-flavor//. Как только выбранный вариант будет скачан, можно приступать к модифицированию системы.

<note tip>Для хранения вариантов системы рекомендуется создать специальную папку, например, ///home/slitaz/flavors//. Можно создать ее перед началом работы и выполнять все команды уже из нее:

<code>
# mkdir -p /home/slitaz/flavors
# cd /home/slitaz/flavors
</code>
</note>


=====Часть II. Создание своего дистрибутива=====

<note important>При создании дистрибутива необходимо помнить, что существуют специальные пакеты серии //base-system//, которые обязаны присутствовать в системе. Информация о зависимостях в каждом пакете укажет на эти пакеты, и они будут установлены, даже если в списке пакетов их не было.</note>

Если вы создаете ISO в первый раз, советуем перестраивать исходный Live CD, не изменяя списка пакетов. Когда вы уже достаточно освоитесь, вы можете приступать к удалению пакетов или добавлению новых, которые нужны вам. Команда //gen-distro// собирает ISO-образ из всех пакетов, указанных в списке. Все зависимости будут автоматически удовлетворены, точно так же, как и при обычной установке пакетов. Эту команду нужно запускать от имени root и из той же папки, где находятся список пакетов и файл конфигурации.

Tazlito использует файл //distro-packages.list// для получения из Интернета всех пакетов и их «установки» в псевдо-файловую систему. Этот файл представляет собой дерево файлов дистрибутива, он содержит всю систему, из которой будет впоследствии создан Live CD. (Это не то же самое, что делает команда //chroot// в одной системе из Live CD другой системы.) Затем файловая система сжимается и помещается в ISO-образ с информацией, необходимой для загрузки.

Итак, для создания Live CD выполните команду

<code># tazlito gen-distro</code>

Вуаля! Ваш первый образ Live CD теперь находится в папке ///home/slitaz/distro//!


===Очистка и пересборка образа===

После того как вы создатите Live CD, потребуется навести в системе порядок, чтобы создавать другой Live CD. Удалить предыдущий ISO-образ и очистить дерево файлов образа системы (при этом ваши дополнительные файлы останутся) можно всего одной командой:

<code># tazlito clean-distro</code>

Теперь можно создавать новый Live CD. Для начала добавьте в список один или два пакета, а потом соберите образ командой //gen-distro//:

<code># tazlito gen-distro</code>

Все проделанные изменения войдут в новый образ системы.

Tazlito может также выполнять и другие задачи, например, записывать ISO-образы на диски, добавлять файлы в систему или напрямую на CD-ROM. Подробную информацию вы найдете в [[http://hg.slitaz.org/tazlito/raw-file/tip/doc/tazlito.en.html|руководстве по Tazlito]].


===Пользователь по имени Хакер===

Если вы хотите иметь учетную запись hacker, в первую очередь необходимо распаковать корневую файловую систему, добавить соответствующего пользователя (оба шага выполняются одной командой) и перепаковать файловую систему заново:

<code>
# tazlito addhacker
# tazlito gen-initiso
</code>

Эти команды добавляют пользователя только в Live CD, система, в которой вы работаете, изменена не будет.


=====Добавление файлов=====

Flavor-файлы обычно содержат дополнительные файлы, которые копируются напрямую в файловую систему или в корневой каталог CD-ROM. Путь к таким файлам указан в файле настроек //tazlito.conf// — по умолчанию они находятся в ///home/slitaz/distro/addfiles//. В частности, базовый вариант системы в качестве дополнительных файлов имеет оконный менеджер JWM и несколько обоев. При этом совсем несложно модифицировать, добавлять или удалять файлы в корневой файловой системе (rootfs) или корневом каталоге CD (rootcd) и перепаковать дистрибутив. Для очистки и сборки дистрибутива выполните команды:

<code>
# tazlito clean-distro
# tazlito gen-distro
</code>


=====Использование пакетов=====

Для создания дистрибутива вам понадобятся пакеты SliTaz. Вы можете легко создавать собственные пакеты с помощью утилиты Tazpkg или воссоздавать их из рабочей системы SliTaz, используя Tazlito. По умолчанию пакеты SliTaz находятся в папке ///home/slitaz/packages//, но путь к ним можно изменить в файле конфигурации Tazlito (см. ниже).

Если вы хотите скачивать пакеты вручную, вам понадобится программа для работы с FTP, например, gFTP (она входит в состав SliTaz) или консольная утилита wget. Прямая ссылка к репозиторию пакетов: ''ftp://download.tuxfamily.org/slitaz/packages/''

Также вы можете включать и собственные пакеты, поместив их в папку //packages//. Дальнейшая информация по созданию пакетов для SliTaz находится в [[ru:cookbook:start|Cookbook]].


=====Файл конфигурации=====

Tazlito использует файл //tazlito.conf//, находящийся в текущей папке, если она существует, или привязывается к файлу ///etc/tazlito/tazlito.conf//. Это означает, что вы можете использовать или файл по умолчанию, или файл настроек, специфичный для создаваемого вами дистрибутива.

Файл настроек содержит следующие параметры:

  * имя ISO-образа (//ISO_IMAGE//)
  * метка, используемая при монтировании (//VOLUME_NAME//)
  * имя разработчика (//PREPARED//)
  * пути к рабочим папкам:
    * дерево дистрибутива (//DISTRO//)
      * по умолчанию: ///home/slitaz/distro//
    * пакеты, которые могут быть установлены (//PACKAGES_REPOSITORY//)
      * по умолчанию: ///home/slitaz/packages//
    * файлы, которые будут добавлены на Live CD (//ADDFILES//)
      * по умолчанию: //$DISTRO/addfiles//
  * опции для запуска Tazlito из Qemu (QEMU_OPTS)
  * алгоритм компрессии для создания корневой файловой системы (//COMPRESSION//):
    * lzma (по умолчанию)
    * gzip
    * bzip2

Чтобы создать и отредактировать собственный файл настроек, запустите Tazlito с опцией //configure// из рабочей папки создаваемого дистрибутива. Допустим, что дерево вашего будущего дистрибутива находится в ///home/slitaz/distro// и вы находитесь в этой же папке, тогда используйте команду

<code># tazlito configure</code>

Ответив на все вопросы, можно либо создать ISO-образ, либо перестроить корневую файловую систему и сам образ, или же создать новый дистрибутив, используя список пакетов.

<note tip>Если вы создаете множество Live CD, полезно будет включить в имя каждого файла дату его создания. Для этого используйте следующую строку:

<file>ISO_NAME=“MyLiveCD-`date +%Y%m%d-%H%M`”</file>
</note>


=====Дополнительно: создание варианта системы=====

Tazlito позволяет легко создать собственный вариант системы по результатам создания дистрибутива (командой //gen-distro//). Вариант системы будет включать дополнительные файлы, их описание и список пакетов (который можно будет использовать повторно или обновлять по мере выхода новых версий пакетов). Для создания своего варианта системы, ответив на один или два вопроса, наберите

<code># tazlito gen-flavor new-flavor</code>

Как только вы убедитесь, что созданный вами вариант работает, и протестируете его, можете отправить его команде разработчиков Slitaz и тем самым сделать общедоступным. При этом его можно будет увидеть командой //list-flavor// и скачать по команде //get-flavor//. Отправить вариант можно несколькими способами:

  * сделать объявление в [[http://www.slitaz.org/en/mailing-list.html|списке рассылок]];
  * сохранить файл где-либо в Интернете и сообщить о нём на [[http://forum.slitaz.org/|форуме]];
  * отправить e-mail тому, кто занимается наполнением SliTaz. Имея соответствующие полномочия, он опубликует ваш файл на серверах SliTaz.


=====Установка Tazlito в другой дистрибутив=====

Tazlito не создает зависимостей для Live CD, но он использует Cdrkit для записи образа на диск и Tazpkg для управления пакетами SliTaz, которые будут включены в новый дистрибутив. Чтобы скачать и установить Tazlito, следуйте инструкциям в файле README из состава [[http://download.tuxfamily.org/slitaz/sources/tazlito/|исходников Tazlito]].

----
Статью перевел [[http://forum.slitaz.org/index.php/profile/1273/Cyril|Cyril]]
